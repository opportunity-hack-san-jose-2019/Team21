<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">

  <!-- Information for Google Oauth 2.0 -->
  <meta name="google-signin-client_id" content="823153065330-4hs1mkpdtjpkopr98cjj3dmlr6n68vov.apps.googleusercontent.com">
  <link rel="stylesheet" href="css/style.css">
  <title>Document</title>
 </head>

 <body>
    <script src="https://apis.google.com/js/client:plusone.js" type="application/javascript"></script>
   <header id="showcase">
     <h1>ClassUp</h1>

     <div id="my-signin2"></div>

     <script>
       function onSuccess(googleUser) {
         console.log('Logged in as: ' + googleUser.getBasicProfile().getName());
         authenticate().then(loadClient).then(execute());
       }
       function onFailure(error) {
         console.log(error);
       }
       function renderButton() {
         gapi.signin2.render('my-signin2', {
           'scope': 'profile email',
           'width': 240,
           'height': 50,
           'longtitle': true,
           'theme': 'dark',
           'onsuccess': onSuccess,
           'onfailure': onFailure
         });
       }
     </script>

     <script src="https://apis.google.com/js/platform.js?onload=renderButton" async defer></script>


     <script src="https://apis.google.com/js/api.js"></script>
    <script>
      /**
       * Sample JavaScript code for classroom.courses.list
       * See instructions for running APIs Explorer code samples locally:
       * https://developers.google.com/explorer-help/guides/code_samples#javascript
       */

      function authenticate() {
        return gapi.auth2.getAuthInstance()
            .signIn({scope: "https://www.googleapis.com/auth/classroom.courses https://www.googleapis.com/auth/classroom.courses.readonly https://www.googleapis.com/auth/classroom.coursework.me https://www.googleapis.com/auth/classroom.coursework.me.readonly https://www.googleapis.com/auth/classroom.coursework.students https://www.googleapis.com/auth/classroom.coursework.students.readonly https://www.googleapis.com/auth/classroom.coursework.me https://www.googleapis.com/auth/classroom.coursework.me.readonly https://www.googleapis.com/auth/classroom.coursework.students https://www.googleapis.com/auth/classroom.coursework.students.readonly https://www.googleapis.com/auth/classroom.student-submissions.me.readonly https://www.googleapis.com/auth/classroom.student-submissions.students.readonly"})
            .then(function() { console.log("Sign-in successful"); },
                  function(err) { console.error("Error signing in", err); });
      }
      function loadClient() {
        //console.log(gapi);
        gapi.client.setApiKey("AIzaSyDVX52aWQU6o9Qipyt5vIytK4UrZhilVsc");
        return gapi.client.load("https://content.googleapis.com/discovery/v1/apis/classroom/v1/rest")
            .then(function() { console.log("GAPI client loaded for API"); },
                  function(err) { console.error("Error loading GAPI client for API", err); });
      }
      // Make sure the client is loaded and sign-in is complete before calling this method.
      function execute() {
        return gapi.client.classroom.courses.list({
          "courseStates": [
            "ACTIVE"
          ]
        })
            //Obtain the courseId of each course
            .then(function(response) {
                    var arr = [];
                    results = response.result.courses;
                    for(var i = 0; i < results.length; i++)
                    {
                      //console.log([results[i].id,results[i].name]);
                      arr.push(results[i].id);
                    }
                    return arr;
                  })
                  //obtain the coursework of each course
                  .then(function(response) {
                    console.log(response);

                    console.log(gapi.client.classroom.courses.courseWork.list({"courseId": "46904651667"}));

                    for(i = 0; i < response.length; i++) {
                      var courseId = response[i];
                      executeCourseWork(courseId);
                      //console.log(courseId);

                  }
      });
      
      gapi.load("client:auth2", function() {
        gapi.auth2.init({client_id: "823153065330-4hs1mkpdtjpkopr98cjj3dmlr6n68vov.apps.googleusercontent.com"});
      });
    }

    function executeCourseWork(courseIde) {
    return gapi.client.classroom.courses.courseWork.list({
      "courseId": courseIde
    })
        .then(function(response) {
                // Handle the results here (response.result has the parsed body).
                //console.log("Response", response);
                if(response.result.courseWork != undefined){
                  results = response.result.courseWork;
                  console.log(results);
                }
                else
                {
                  console.log("no coursework to be found");
                }
                
              },
              function(err) { console.error("Execute error", err); });
  }
  gapi.load("client:auth2", function() {
    gapi.auth2.init({client_id: "823153065330-4hs1mkpdtjpkopr98cjj3dmlr6n68vov.apps.googleusercontent.com"});
  });




    </script>

   </header>

 </body>
 </html>
